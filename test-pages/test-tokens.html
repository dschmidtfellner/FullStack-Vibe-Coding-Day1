<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JWT Token Tester</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .user-card { border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 8px; }
        .token { font-family: monospace; font-size: 12px; word-break: break-all; background: #f5f5f5; padding: 10px; margin: 10px 0; }
        button { background: #6366f1; color: white; padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #4f46e5; }
        .info { background: #f0f9ff; padding: 15px; border-radius: 8px; margin: 20px 0; }
    </style>
</head>
<body>
    <h1>JWT Authentication Tester</h1>
    
    <div class="info">
        <h3>üß™ How to Test:</h3>
        <ol>
            <li>Click a "Test as [Role]" button below</li>
            <li>This will open the chat app with that user's token</li>
            <li>Try different childId parameters to test permissions</li>
            <li>Check that users can only access authorized conversations</li>
        </ol>
    </div>

    <h2>Test Users</h2>

    <div class="user-card">
        <h3>üë© Sarah Johnson (Parent)</h3>
        <p><strong>Role:</strong> parent</p>
        <p><strong>Access:</strong> child_123 only</p>
        <p><strong>Token:</strong></p>
        <div class="token" id="parent1-token">Loading...</div>
        <button onclick="testUser('parent1', 'child_123')">Test as Sarah (Authorized Child)</button>
        <button onclick="testUser('parent1', 'child_456')">Test as Sarah (Unauthorized Child)</button>
    </div>

    <div class="user-card">
        <h3>üë® Mike Wilson (Parent)</h3>
        <p><strong>Role:</strong> parent</p>
        <p><strong>Access:</strong> child_456 only</p>
        <p><strong>Token:</strong></p>
        <div class="token" id="parent2-token">Loading...</div>
        <button onclick="testUser('parent2', 'child_456')">Test as Mike (Authorized Child)</button>
        <button onclick="testUser('parent2', 'child_123')">Test as Mike (Unauthorized Child)</button>
    </div>

    <div class="user-card">
        <h3>üë©‚Äç‚öïÔ∏è Dr. Lisa Chen (Provider)</h3>
        <p><strong>Role:</strong> provider</p>
        <p><strong>Access:</strong> child_123, child_456, child_789</p>
        <p><strong>Token:</strong></p>
        <div class="token" id="provider-token">Loading...</div>
        <button onclick="testUser('provider', 'child_123')">Test Provider (Child 123)</button>
        <button onclick="testUser('provider', 'child_456')">Test Provider (Child 456)</button>
        <button onclick="testUser('provider', 'child_999')">Test Provider (Unauthorized Child)</button>
    </div>

    <div class="user-card">
        <h3>üëë Admin User</h3>
        <p><strong>Role:</strong> admin</p>
        <p><strong>Access:</strong> All children</p>
        <p><strong>Token:</strong></p>
        <div class="token" id="admin-token">Loading...</div>
        <button onclick="testUser('admin', 'child_123')">Test Admin (Child 123)</button>
        <button onclick="testUser('admin', 'child_999')">Test Admin (Child 999)</button>
    </div>

    <h2>Error Cases to Test</h2>
    <button onclick="testInvalidToken()">Test Invalid Token</button>
    <button onclick="testNoToken()">Test No Token</button>
    <button onclick="testExpiredToken()">Test Expired Token</button>

    <script>
        // These tokens will be generated by our JWT system
        const testTokens = {
            parent1: null,
            parent2: null, 
            provider: null,
            admin: null
        };

        // Generate tokens when page loads
        async function generateTokens() {
            try {
                // For now, we'll use the tokens from the console
                // In a real scenario, these would come from your Bubble app
                console.log('Open browser console to see test tokens being generated');
                
                // You can manually copy tokens from the browser console when running the app
                document.getElementById('parent1-token').textContent = 'Check browser console for tokens';
                document.getElementById('parent2-token').textContent = 'Check browser console for tokens';
                document.getElementById('provider-token').textContent = 'Check browser console for tokens';
                document.getElementById('admin-token').textContent = 'Check browser console for tokens';
            } catch (error) {
                console.error('Error generating tokens:', error);
            }
        }

        function testUser(userType, childId) {
            // For testing, we'll navigate to the chat app with childId only
            // The app will use default test tokens in development mode
            const baseUrl = 'http://localhost:5173/';
            const url = `${baseUrl}?childId=${childId}`;
            
            console.log(`Testing ${userType} with childId: ${childId}`);
            console.log(`URL: ${url}`);
            
            // Open in new tab
            window.open(url, '_blank');
        }

        function testInvalidToken() {
            const url = 'http://localhost:5173/?childId=child_123&token=invalid.token.here';
            window.open(url, '_blank');
        }

        function testNoToken() {
            const url = 'http://localhost:5173/?childId=child_123';
            window.open(url, '_blank');
        }

        function testExpiredToken() {
            // This would be a token with exp in the past
            const url = 'http://localhost:5173/?childId=child_123&token=expired.token.here';
            window.open(url, '_blank');
        }

        // Generate tokens when page loads
        generateTokens();
    </script>
</body>
</html>